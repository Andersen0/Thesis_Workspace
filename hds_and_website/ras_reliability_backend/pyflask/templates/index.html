<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="/static/styles.css">
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
</head>
<body>
<div class="sidebar">
    <!-- Display the image -->
  <img class="sidebar-image" src="/static/nmbu_square.png" alt="NMBU Image" >
  
  <div class="button-group">
    <button id="toggleButton">Toggle State Visual</button>
    <button id="shutdownButton">Shutdown Server</button>
    <button id="toggleStatusButton">Toggle Status Messages</button>
    <button id="toggleTopicButton">Toggle Topic Messages</button>
    <button id="toggleImageButton">Toggle Live Image</button>
  </div>
  <div id="status-circle" display="block"></div>
  <!-- <p>Last Class: <span id="lastClassDisplay"></span></p>
  <p>Last Distance: <span id="lastDistanceDisplay"></span></p>
  <p>Current State: <span id="state"></span></p> -->




</div>

<div class="content">
  <h1>Safety Properties Monitoring Dashboard</h1>
  <p>Follow README:</p>
  <ul>
    <li>Run the launch file:  <code>$ ros2 launch pyflask my_launch_file.launch.py</code></li>
    <li>Messages are published to:  <code>/rosout</code></li>
  </ul>
  <p> View the tutorial at <a href="https://github.com/mustafma/ras_reliability_backend" target="_blank">ras_reliability_backend</a> or <a href="https://gitlab.com/henrik.nordlie/summer_job_2023" target="_blank">summer_job_2023</a>.</p>
  
  <div class="button-group">
    <button>Export Monitors</button>
    <button>Import Robot State Machine</button>
    <a href="/dtt_data"><button>distance data</button> </a>
    <a href="/classifier_data"><button>class data</button> </a>
    <a href="/alert_data"><button>Alert data</button> </a>
  </div>
  

  <hr/>
  
  
  <h3>SRobot Data Display</h3>
  <p>Current State: <span id="currentState">-</span></p>
  <p>Received Distance Value: <span id="dttValue">-</span></p>
  <p>Classifier Value: <span id="classifierValue">-</span></p>
  <p>Alert Status: <span id="alertStatus">-</span></p>
  <p>Slowdown Status: <span id="slowdownStatus">-</span></p>
  <p>Halt Status: <span id="haltStatus">-</span></p>
  <p>UVC Status: <span id="uvcStatus">-</span></p>
  <p>Time Active: <span id="timerValue">-</span></p>

  <p>Distance Guard: <span id="handlerDttguard">-</span></p>
  <p>Classifier Guard: <span id="handlerclassifierguard">-</span></p>
  <p>Classifier Empty: <span id="handlerclassifierempty">-</span></p>
  <p>Operational State 0: <span id="handleroperationalstate0">-</span></p>
  <p>Operational State 1: <span id="handleroperationalstate1">-</span></p>
  <p>Operational State 2: <span id="handleroperationalstate2">-</span></p>
  <p>Operational State 3: <span id="handleroperationalstate3">-</span></p>
  <p>State Request 101: <span id="handlerstate_req101">-</span></p>
  <p>State Request 102: <span id="handlerstate_req102">-</span></p>
  <p>State Request 103: <span id="handlerstate_req103">-</span></p>
  <p>State Request 104: <span id="handlerstate_req104">-</span></p>
  <p>State Request 201: <span id="handlerstate_req201">-</span></p>
  <p>State Request 202: <span id="handlerstate_req202">-</span></p>
  <p>State Request 203: <span id="handlerstate_req203">-</span></p>
  
  <img id="videoElement" src="">
</div>

<script type="text/javascript" charset="utf-8">

  socket.on('connect', function() {
    console.log('Connected to server');
  });

  // Event listener for toggleButton
  document.getElementById('toggleButton').addEventListener('click', function() {
  // Handle button click here
    console.log('Toggle button clicked');
  // You can emit a socket event or perform any other action here
  });



</script> 

<script>

  function fetchData(endpoint, elementId) {
      fetch(endpoint)
          .then(response => response.json())
          .then(data => {
              document.getElementById(elementId).innerText = data[Object.keys(data)[0]];
          })
          .catch(error => console.error('Error fetching data from ' + endpoint + ':', error));
  }

  // Refresh data every second
  setInterval(() => fetchData('/dtt', 'dttValue'), 100);
  setInterval(() => fetchData('/classifier', 'classifierValue'), 100);
  setInterval(() => fetchData('/alert', 'alertStatus'), 100);
  setInterval(() => fetchData('/halt', 'haltStatus'), 100);
  setInterval(() => fetchData('/slowdown', 'slowdownStatus'), 100);
  setInterval(() => fetchData('/state', 'currentState'), 100);
  setInterval(() => fetchData('/uvc', 'uvcStatus'), 100);
  setInterval(() => fetchData('/timer', 'timerValue'), 100);
</script>

<script>

  function fetchData(endpoint, elementId) {
      fetch(endpoint)
          .then(response => response.json())
          .then(data => {
              document.getElementById(elementId).innerText = data[Object.keys(data)[0]];
          })
          .catch(error => console.error('Error fetching data from ' + endpoint + ':', error));
  }

  // Refresh data every second

  setInterval(() => fetchData('/handlerDtt_assumption', 'handlerDttguard'), 100);
  setInterval(() => fetchData('/handlerclassifier_assumption', 'handlerclassifierguard'), 100);
  setInterval(() => fetchData('/handlerclassifier_empty', 'handlerclassifierempty'), 100);
  setInterval(() => fetchData('/handleroperationalstate_0', 'handleroperationalstate0'), 100);
  setInterval(() => fetchData('/handleroperationalstate_1', 'handleroperationalstate1'), 100);
  setInterval(() => fetchData('/handleroperationalstate_2', 'handleroperationalstate2'), 100);
  setInterval(() => fetchData('/handleroperationalstate_3', 'handleroperationalstate3'), 100);
  setInterval(() => fetchData('/handlerstate_req101', 'handlerstate_req101'), 100);
  setInterval(() => fetchData('/handlerstate_req102', 'handlerstate_req102'), 100);
  setInterval(() => fetchData('/handlerstate_req103', 'handlerstate_req103'), 100);
  setInterval(() => fetchData('/handlerstate_req104', 'handlerstate_req104'), 100);
  setInterval(() => fetchData('/handlerstate_req201', 'handlerstate_req201'), 100);
  setInterval(() => fetchData('/handlerstate_req202', 'handlerstate_req202'), 100);
  setInterval(() => fetchData('/handlerstate_req203', 'handlerstate_req203'), 100);

</script>
</script>


<!-- <script>
  setInterval(function() {
    document.getElementById('videoElement').src = "/stream?" + new Date().getTime();
  }, 50);
</script> -->
</body>
</html>
